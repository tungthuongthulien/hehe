<!doctype html><html lang="vi"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Theo dõi kết quả học tập UTC</title><style>:root{--b:#0f172a;--g:#475569;--bg:#f1f5f9;--card:#ffffff;--line:#cbd5e1;--primary:#2563eb;--primary2:#1d4ed8;--danger:#dc2626;--danger2:#b91c1c;--ok:#16a34a;--okbg:#ecfdf5;--dangerbg:#fff1f2}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:var(--b);font-size:16px}.wrap{max-width:1100px;margin:24px auto;padding:0 16px}h1{font-size:24px;margin:0 0 12px}.grid{display:grid;grid-template-columns:1fr 360px;gap:14px}.sticky{position:sticky;top:14px;align-self:start}@media (max-width:900px){.grid{grid-template-columns:1fr}.sticky{position:static;top:auto}}.card{background:var(--card);border:2px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 8px rgba(15,23,42,.04)}.row{display:flex;gap:10px;flex-wrap:wrap}label{font-size:13px;color:var(--g);display:block;margin-bottom:6px}button,input,select,textarea{font:inherit;border:2px solid var(--line);border-radius:12px;padding:10px 12px;background:#fff;outline:0}input:focus,select:focus,textarea:focus{border-color:rgba(37,99,235,.55);box-shadow:0 0 0 4px rgba(37,99,235,.12)}button{cursor:pointer}.btn{border:2px solid transparent;border-radius:12px;padding:10px 14px;font-weight:600}.btn.small{padding:7px 10px;font-size:13px;border-radius:10px}.btn.primary{background:var(--primary);color:#fff}.btn.primary:hover{background:var(--primary2)}.btn.danger{background:var(--danger);color:#fff}.btn.danger:hover{background:var(--danger2)}button[data-act=delCourse],button[data-act=del]{background:var(--danger);color:#fff;border-color:transparent;font-weight:700}button[data-act=delCourse]:hover,button[data-act=del]:hover{background:var(--danger2)}.term{border:2px solid var(--line);border-radius:14px;padding:12px;margin-top:10px}.term h3{margin:0 0 10px;font-size:16px}.muted{color:var(--g);font-size:13px;line-height:1.4}table{width:100%;border-collapse:collapse;margin-top:10px}td,th{border-top:2px solid var(--line);padding:10px;text-align:left;font-size:14px;vertical-align:middle}th{color:var(--g);font-weight:700}.kpi{display:grid;grid-template-columns:1fr 1fr;gap:10px}.kpi .box{border:2px solid var(--line);border-radius:14px;padding:12px}.big{font-size:26px;font-weight:800}.danger{border-color:rgba(220,38,38,.35);background:var(--dangerbg)}.ok{border-color:rgba(22,163,74,.35);background:var(--okbg)}.badge{display:inline-block;padding:4px 10px;border:2px solid var(--line);border-radius:999px;font-size:13px;font-weight:700}.nowrap{white-space:nowrap}input.course-name{width:200px}input.course-credits,input.course-grade{width:50px}@media (max-width:900px){input.course-name{width:100%}input.course-credits,input.course-grade{width:140px}}.termSummary{margin-top:10px;border:2px dashed var(--line);border-radius:14px;padding:12px}.termSummary .grid4{display:grid;grid-template-columns:1fr 1fr;gap:8px}@media (max-width:520px){.termSummary .grid4{grid-template-columns:1fr}}.retry-row{background:#eef2ff;border-left:4px solid #4f46e5}.retry-label{font-size:13px;color:#334155;margin-bottom:4px}.link-btn{background:0 0;border:none;color:var(--primary);cursor:pointer;font-size:13px;font-weight:700;padding:0}.link-btn:hover{text-decoration:underline}.link-btn.danger{color:var(--danger)}.guide{border:2px solid var(--line);border-radius:14px;padding:12px;background:#f8fafc}.guide-head{display:flex;justify-content:space-between;align-items:center;gap:10px}.guide-title{font-size:16px;font-weight:800}.guide-body{margin-top:10px}.guide-list{margin:0;padding-left:18px;line-height:1.5}.btn.ghost{background:0 0;color:var(--primary);border:2px solid rgba(37,99,235,.35);font-weight:800;padding:8px 12px}.btn.ghost:hover{border-color:rgba(37,99,235,.6);background:rgba(37,99,235,.06)}.need-note-strong{font-size:14px;font-weight:800;line-height:1.45}.need-num{color:var(--danger);font-weight:900}</style></head><body><div class="wrap"><div class="grid"><div class="card"><div class="guide" id="guideBox" style="margin-top:12px"><div class="guide-head"><div class="guide-title">Hướng dẫn</div><button id="toggleGuide" class="btn ghost" type="button">Thu gọn</button></div><div class="guide-body" id="guideBody"><ol class="guide-list"><li>Nhấn <b>+ Thêm kỳ</b> để tạo kỳ học. Khi thêm kỳ sẽ có 2 chế độ nhập<ul style="margin:8px 0 0;padding-left:18px;line-height:1.55"><li style="margin-bottom:8px"><b>Nhập điểm tổng kết kỳ</b> (Chỉ nhập theo cách này khi mọi người <b>không học lại</b> môn nào trong kỳ đấy và <b>không muốn học nâng điểm</b> môn nào). Nếu nhập theo cách này thì điểm tổng kết GPA có thể bị sai số một chút (<b>tối đa 0,01</b>).</li><li><b>Nhập điểm theo từng môn</b> (<b>Nên nhập theo cách này</b>). Chỉ cần nhập <b>số tín chỉ</b> và <b>điểm hệ 10</b> của môn đấy là được. Tên môn không cần nhập cũng được. Nếu dùng dùng nhiều thì cứ nhập tên môn vào cho đỡ nhầm. Vì khi thoát ra thì số liệu nó vẫn lưu trên trình duyệt, lần sau vào không phải nhập lại nữa.</li></ul></li><li style="margin-top:10px">Trong phần <b>Nhập điểm theo từng môn</b>:<br>Mấy môn <b>không tính vào GPA</b> như Giáo dục quốc phòng, Giáo dục thể chất, Tiếng Anh A1 A2 thì không cần nhập.</li><li style="margin-top:10px">Cũng trong phần <b>Nhập điểm theo từng môn</b>:<ul style="margin:8px 0 0;padding-left:18px;line-height:1.55"><li style="margin-bottom:8px">Mấy môn có điểm <b>C+</b>/<b>C</b>/<b>D+</b>/<b>D</b> thì cột <b>Ghi chú</b> sẽ hiện <b>Học nâng điểm</b>. Bấm vào sẽ hiện thêm 1 hàng để nhập điểm sau khi nâng. Thì mục đích của cái này là để tính xem khi mà mình học nâng điểm GPA của mình nó lên bao nhiêu.</li><li>Môn nào có điểm <b>F+</b> hoặc <b>F</b> thì cột <b>Ghi chú</b> sẽ hiện <b>Học lại</b>, chức năng tương tự như trên.</li></ul></li><li style="margin-top:10px">Với những kỳ chưa học thì chọn chế độ <b>Nhập điểm tổng kết kỳ</b>. Chỉ cần nhập <b>số tín chỉ</b> và để trống GPA kỳ. Phần <b>Mục tiêu loại bằng</b> sẽ tự tính tổng tín chỉ chưa học và GPA cần đạt cho phần còn lại.</li><li style="margin-top:10px">Mọi người để ý là nếu học quá 5% số tín chỉ thì sẽ bị hạ bằng (chỉ áp dụng đối với bằng giỏi và xuất sắc). Cái này mọi người tự xem nhá. Vì mình cũng không biết là mấy môn GDQP, GDTC, nó có tính vào tổng tín chỉ không. Với lại khi mà Học lại thì nó có tính vào 5% đấy không.</li><li style="margin-top:10px">Mọi người nếu có góp ý hoặc thông tin bổ sung cho mục 5 thì liên hệ mình qua email <a href="https://mail.google.com/mail/?view=cm&fs=1&to=loctung126@gmail.com" target="_blank">loctung126@gmail.com </a>nhá.<br>Mình sẽ kiểm tra rồi cập nhật lại.<br>Cảm ơn mọi người!</li></ol></div></div><div id="terms" style="margin-top:10px"></div><div class="row" style="justify-content:flex-end;margin-top:12px"><button id="reset" class="btn danger">Xóa dữ liệu</button> <button id="addTerm" class="btn primary">+ Thêm kỳ</button></div></div><div class="card sticky"><h3 style="margin:0 0 10px">Tổng kết</h3><div class="kpi"><div class="box"><div class="muted">Tổng số tín chỉ</div><div class="big" id="creditsAll">0</div></div><div class="box"><div class="muted">Tổng số tín chỉ tích lũy</div><div class="big" id="creditsPass">0</div></div><div class="box"><div class="muted">Điểm TB hệ 4</div><div class="big" id="gpaAll">0.00</div></div><div class="box"><div class="muted">Điểm TB tích lũy hệ 4</div><div class="big" id="gpaPass">0.00</div></div><div class="box"><div class="muted">Tổng số tín chỉ học lại</div><div class="big" id="creditsRetake">0</div></div><div class="box" style="grid-column:1/-1"><div class="muted">Loại bằng hiện tại</div><div class="big" id="degree">—</div></div></div><hr style="border:none;border-top:2px solid var(--line);margin:14px 0"><h3 style="margin:0 0 10px">Mục tiêu loại bằng</h3><div class="box" style="margin-bottom:10px"><div class="muted">Số tín chỉ chưa học</div><div class="big" id="unlearnedCredits">0</div></div><div class="row"><div style="flex:1"><label>Mục tiêu của bạn là loại bằng</label> <select id="target"><option value="2.5">Khá (2.5)</option><option value="3.2">Giỏi (3.2)</option><option value="3.6">Xuất sắc (3.6)</option></select></div></div><div style="margin-top:10px" class="box" id="needBox"><div class="big" id="need">—</div><div class="muted" id="needNote"></div></div></div></div></div><script>document.addEventListener("contextmenu",function(t){t.preventDefault()},{capture:!0}),document.addEventListener("keydown",function(t){var e=(t.key||"").toLowerCase();if("f12"===e||(t.ctrlKey||t.metaKey)&&!t.altKey&&("u"===e||"s"===e||"p"===e)||(t.ctrlKey||t.metaKey)&&t.shiftKey&&("i"===e||"j"===e||"c"===e))return t.preventDefault(),t.stopPropagation(),!1},!0);const DEGREE_THRESHOLDS=[{name:"Xuất sắc",min:3.6},{name:"Giỏi",min:3.2},{name:"Khá",min:2.5},{name:"Trung bình",min:2},{name:"Yếu",min:1},{name:"Kém",min:0}],LETTER_THRESHOLDS=[{letter:"A+",min10:9.5,gpa4:4},{letter:"A",min10:8.5,gpa4:3.8},{letter:"B+",min10:8,gpa4:3.5},{letter:"B",min10:7,gpa4:3},{letter:"C+",min10:6,gpa4:2.5},{letter:"C",min10:5.5,gpa4:2},{letter:"D+",min10:4.5,gpa4:1.5},{letter:"D",min10:4,gpa4:1},{letter:"F+",min10:2,gpa4:.5},{letter:"F",min10:-1/0,gpa4:0}],LS_KEY="study_tracker_v2",$=t=>document.getElementById(t),MIN_COURSES_VISIBLE=5;function ensureMinCourses(t,e=5){if(t&&"courses"===t.mode)for(Array.isArray(t.courses)||(t.courses=[]);t.courses.length<e;)t.courses.push({name:"",credits:"",attempts:[{type:"main",grade10:""}]})}function loadState(){try{const t=JSON.parse(localStorage.getItem(LS_KEY))||{terms:[]};return(t.terms||[]).forEach(t=>{t.summary||(t.summary={gpa4:"",credits:""}),t.mode||(t.mode="courses"),"boolean"!=typeof t.collapsed&&(t.collapsed=!1),Array.isArray(t.courses)||(t.courses=[]),(t.courses||[]).forEach(t=>{if(!Array.isArray(t.attempts)){const e=t.grade10??"";t.attempts=[{type:"main",grade10:e}],delete t.grade10}t.attempts.length||(t.attempts=[{type:"main",grade10:""}])}),ensureMinCourses(t,5)}),t}catch{return{terms:[]}}}let state=loadState();function saveState(){localStorage.setItem(LS_KEY,JSON.stringify(state))}function clamp(t,e,n){return Math.max(e,Math.min(n,t))}function degreeFromCgpa(t){for(const e of DEGREE_THRESHOLDS)if(t>=e.min)return e.name;return"—"}function normalizeOneDecimal(t){let e=String(t??"").trim();if(!e)return"";e=e.replace(",","."),e=e.replace(/[^\d.]/g,"");const n=e.indexOf(".");return-1!==n?(e=e.slice(0,n+1)+e.slice(n+1).replace(/\./g,""),e=e.replace(/^(\d+)\.(\d).*/,"$1.$2")):e=e.replace(/^0+(\d)/,"$1"),e}function normalizeTwoDecimals(t){let e=String(t??"").trim();if(!e)return"";e=e.replace(",","."),e=e.replace(/[^\d.]/g,"");const n=e.indexOf(".");return-1!==n?(e=e.slice(0,n+1)+e.slice(n+1).replace(/\./g,""),e=e.replace(/^(\d+)\.(\d{0,2}).*$/,(t,e,n)=>n?`${e}.${n}`:`${e}.`)):e=e.replace(/^0+(\d)/,"$1"),e}function parseDecimal1(t){const e=normalizeOneDecimal(t);if(!e||"."===e)return null;const n=Number(e);return Number.isFinite(n)?n:null}function parseDecimal2(t){const e=normalizeTwoDecimals(t);if(!e||"."===e)return null;const n=Number(e);return Number.isFinite(n)?n:null}function parseIntSafe(t){const e=String(t??"").trim().replace(/[^\d]/g,"");if(!e)return null;const n=Number(e);return Number.isFinite(n)?n:null}function letterFrom10(t){for(const e of LETTER_THRESHOLDS)if(t>=e.min10)return e.letter;return"F"}function gpa4FromLetter(t){const e=LETTER_THRESHOLDS.find(e=>e.letter===t);return e?e.gpa4:0}function from10ToLetterGpa4(t){if(null==t)return{letter:"—",gpa4:null};const e=letterFrom10(t);return{letter:e,gpa4:gpa4FromLetter(e)}}function evaluationFromGpa4(t){return null==t?"—":t<1?"HOCLAI":"DAT"}function getCourseAction(t){return["C+","C","D+","D"].includes(t)?{kind:"upgrade",label:"Học nâng điểm"}:["F","F+"].includes(t)?{kind:"retake",label:"Học lại"}:null}function attemptLabel(t){return"main"===t?"Lần 1":"upgrade"===t?"Nâng điểm":"retake"===t?"Học lại":"Lần khác"}function ensureCourseShape(t){t.attempts&&Array.isArray(t.attempts)&&0!==t.attempts.length||(t.attempts=[{type:"main",grade10:""}])}function bestAttemptGpa4(t){let e=null;for(const n of t.attempts||[]){const t=parseDecimal1(n.grade10),{gpa4:a}=from10ToLetterGpa4(t);null!=a&&(null==e||a>e)&&(e=a)}return e}function escapeHtml(t){return String(t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}function escapeAttr(t){return escapeHtml(t).replace(/"/g,"&quot;")}function calcRetakeCredits(t){let e=0;for(const n of t)if("courses"===n.mode)for(const t of n.courses||[]){ensureCourseShape(t);const n=parseIntSafe(t.credits)||0;if(n<=0)continue;let a=!1;for(const e of t.attempts||[]){const t=parseDecimal1(e.grade10);if(null!=t&&t<4){a=!0;break}}a&&(e+=n)}return e}function calcUnlearnedCredits(t){let e=0;for(const n of t){if("summary"===n.mode){const t=parseDecimal2(n.summary?.gpa4),a=parseIntSafe(n.summary?.credits)||0;a>0&&null==t&&(e+=a);continue}if("courses"===n.mode)for(const t of n.courses||[]){ensureCourseShape(t);const n=parseIntSafe(t.credits)||0;if(n<=0)continue;let a=!1;for(const e of t.attempts||[]){const t=parseDecimal1(e.grade10);if(null!=t&&t<4){a=!0;break}}if(!a)continue;const s=bestAttemptGpa4(t);(null==s||s<1)&&(e+=n)}}return e}function calcTotals(t){let e=0,n=0,a=0,s=0;for(const r of t)if("summary"===r.mode){const t=parseDecimal2(r.summary.gpa4),d=parseIntSafe(r.summary.credits)||0;null!=t&&d>0&&(e+=t*d,n+=d,t>=1&&(a+=t*d,s+=d))}else for(const t of r.courses){ensureCourseShape(t);const r=parseIntSafe(t.credits)||0,d=bestAttemptGpa4(t);null!=d&&r>0&&(e+=d*r,n+=r,d>=1&&(a+=d*r,s+=r))}return{S_all:e,C_all:n,gpaAll:n>0?e/n:0,S_pass:a,C_pass:s,gpaPass:s>0?a/s:0}}function render(){const t=$("terms");t.innerHTML="",state.terms.forEach((e,n)=>{ensureMinCourses(e,5);const a=document.createElement("div");a.className="term";const s="courses"===e.mode,r=e.collapsed?"Hiện":"Ẩn";a.innerHTML=`\n      <div class="row" style="justify-content:space-between;align-items:center">\n        <h3 style="margin:0">Kỳ ${n+1}</h3>\n        <div class="row" style="align-items:center">\n          ${s?`\n            <button class="btn ghost small" data-act="toggleTerm" data-idx="${n}">\n              ${r}\n            </button>\n          `:""}\n          <button class="btn danger" data-act="del" data-idx="${n}">Xóa kỳ</button>\n        </div>\n      </div>\n\n      <div class="row" style="margin-top:10px">\n        <div>\n          <label>Chế độ nhập</label>\n          <select data-act="mode" data-idx="${n}">\n            <option value="courses" ${"courses"===e.mode?"selected":""}>Nhập theo môn</option>\n            <option value="summary" ${"summary"===e.mode?"selected":""}>Nhập tổng kết kỳ</option>\n          </select>\n        </div>\n      </div>\n\n      <div data-sec="courses" style="display:${"courses"!==e.mode||e.collapsed?"none":"block"};margin-top:10px">\n        ${renderCoursesTable(e,n)}\n        <div class="row" style="justify-content:flex-end;margin-top:10px">\n          <button class="btn primary" data-act="addCourse" data-idx="${n}">+ Thêm môn</button>\n        </div>\n      </div>\n\n      <div data-sec="summary" style="display:${"summary"===e.mode?"block":"none"};margin-top:10px">\n        <div class="row">\n          <div>\n            <label>GPA kỳ (hệ 4)</label>\n            <input inputmode="decimal" data-act="sumGpa4" data-idx="${n}"\n              value="${escapeAttr(e.summary.gpa4??"")}" placeholder="VD: 3.45 hoặc 3,45 (để trống nếu chưa học)" />\n          </div>\n          <div>\n            <label>Tổng tín chỉ kỳ</label>\n            <input inputmode="numeric" data-act="sumCredits" data-idx="${n}"\n              value="${escapeAttr(e.summary.credits??"")}" placeholder="VD: 18" />\n          </div>\n          <div class="muted" style="max-width:420px">\n            * Nếu kỳ này chưa học thì chỉ cần nhập tổng tín chỉ là được.\n          </div>\n        </div>\n      </div>\n\n      ${"courses"===e.mode?`\n        <div class="termSummary" id="termSum-${n}">\n          ${renderTermSummary(e,n)}\n        </div>\n      `:""}\n    `,t.appendChild(a)}),updateOverviewAndNeed(),saveState()}function renderCoursesTable(t,e){return`\n    <table>\n      <thead>\n        <tr>\n          <th>STT</th>\n          <th>Tên môn</th>\n          <th>Tín chỉ *</th>\n          <th>Điểm hệ 10 *</th>\n          <th>Điểm chữ</th>\n          <th>Hệ 4</th>\n          <th>Đánh giá</th>\n          <th>Ghi chú</th>\n          <th></th>\n        </tr>\n      </thead>\n      <tbody>\n        ${(t.courses||[]).map((t,n)=>{ensureCourseShape(t);const a=from10ToLetterGpa4(parseDecimal1((t.attempts[0]||{type:"main",grade10:""}).grade10)),s="—"!==a.letter?getCourseAction(a.letter):null,r=t.attempts.length>=2,d=t.attempts.length;let o="";for(let a=0;a<t.attempts.length;a++){const i=t.attempts[a],c=from10ToLetterGpa4(parseDecimal1(i.grade10)),l=evaluationFromGpa4(c.gpa4),u=a>0,m=u?"retry-row":"",p=u?`<div class="retry-label">${attemptLabel(i.type)}</div>`:"";let g="";g=u?`\n          <button class="link-btn danger"\n            data-act="removeAttempt"\n            data-idx="${e}"\n            data-cidx="${n}"\n            data-aidx="${a}">\n            Xóa lần này\n          </button>\n        `:s&&!r?`\n            <button class="link-btn ${"retake"===s.kind?"danger":""}"\n              data-act="addAttempt"\n              data-kind="${s.kind}"\n              data-idx="${e}"\n              data-cidx="${n}">\n              ${s.label}\n            </button>\n          `:'<span class="muted">—</span>',o+=`\n        <tr class="${m}">\n          ${0===a?`\n            <td class="nowrap" rowspan="${d}">${n+1}</td>\n            <td rowspan="${d}">\n              <input class="course-name" data-act="cName" data-idx="${e}" data-cidx="${n}"\n                value="${escapeAttr(t.name||"")}" placeholder=""/>\n            </td>\n            <td rowspan="${d}">\n              <input class="course-credits" inputmode="numeric" data-act="cCredits" data-idx="${e}" data-cidx="${n}"\n                value="${escapeAttr(t.credits??"")}" placeholder="" />\n            </td>\n          `:""}\n\n          <td>\n            ${p}\n            <input class="course-grade" inputmode="decimal"\n              data-act="cGrade10"\n              data-idx="${e}"\n              data-cidx="${n}"\n              data-aidx="${a}"\n              value="${escapeAttr(i.grade10??"")}"\n              placeholder="" />\n          </td>\n\n          <td class="nowrap">\n            <span class="badge"\n              data-out="letter"\n              data-idx="${e}" data-cidx="${n}" data-aidx="${a}">\n              ${c.letter}\n            </span>\n          </td>\n\n          <td class="nowrap">\n            <span data-out="gpa4"\n              data-idx="${e}" data-cidx="${n}" data-aidx="${a}">\n              ${null==c.gpa4?"—":c.gpa4.toFixed(1)}\n            </span>\n          </td>\n\n          <td class="nowrap">\n            <span class="badge ${"DAT"===l?"ok":"HOCLAI"===l?"danger":""}"\n              data-out="eval"\n              data-idx="${e}" data-cidx="${n}" data-aidx="${a}">\n              ${l}\n            </span>\n          </td>\n\n          <td class="nowrap">\n            ${0===a?`<span data-out="note" data-idx="${e}" data-cidx="${n}">${g}</span>`:g}\n          </td>\n\n          ${0===a?`\n            <td rowspan="${d}">\n              <button class="btn danger" data-act="delCourse" data-idx="${e}" data-cidx="${n}">Xóa</button>\n            </td>\n          `:""}\n        </tr>\n      `}return o}).join("")||'<tr><td colspan="9" class="muted">Chưa có môn nào.</td></tr>'}\n      </tbody>\n    </table>\n  `}function calcTermTotals(t){let e=0,n=0,a=0,s=0;if("summary"===t.mode){const r=parseDecimal2(t.summary.gpa4),d=parseIntSafe(t.summary.credits)||0;null!=r&&d>0&&(e+=r*d,n+=d,r>=1&&(a+=r*d,s+=d))}else for(const r of t.courses){ensureCourseShape(r);const t=parseIntSafe(r.credits)||0,d=bestAttemptGpa4(r);null!=d&&t>0&&(e+=d*t,n+=t,d>=1&&(a+=d*t,s+=t))}return{C_all:n,C_pass:s,gpaAll:n>0?e/n:0,gpaPass:s>0?a/s:0}}function renderTermSummary(t,e){const n=calcTermTotals(t);return`\n    <div class="muted" style="margin-bottom:8px"><b>Tổng kết kỳ</b></div>\n    <div class="grid4">\n      <div><span class="muted">Tổng số tín chỉ :</span> <b id="tCAll-${e}">${n.C_all}</b></div>\n      <div><span class="muted">Tổng số tín chỉ tích lũy :</span> <b id="tCPass-${e}">${n.C_pass}</b></div>\n      <div><span class="muted">Điểm TB hệ 4:</span> <b id="tGAll-${e}">${n.gpaAll.toFixed(2)}</b></div>\n      <div><span class="muted">ĐIểm TB tích lũy hệ 4:</span> <b id="tGPass-${e}">${n.gpaPass.toFixed(2)}</b></div>\n    </div>\n  `}function updateAttemptOutputs(t,e,n){const a=state.terms?.[t];if(!a||"courses"!==a.mode)return;const s=a.courses?.[e];if(!s)return;ensureCourseShape(s);const r=s.attempts?.[n];if(!r)return;const d=from10ToLetterGpa4(parseDecimal1(r.grade10)),o=evaluationFromGpa4(d.gpa4),i=a=>document.querySelector(`[data-out="${a}"][data-idx="${t}"][data-cidx="${e}"][data-aidx="${n}"]`),c=i("letter"),l=i("gpa4"),u=i("eval");if(c&&(c.textContent=d.letter),l&&(l.textContent=null==d.gpa4?"—":d.gpa4.toFixed(1)),u&&(u.textContent=o,u.classList.toggle("ok","DAT"===o),u.classList.toggle("danger","HOCLAI"===o)),0===n){const n=document.querySelector(`[data-out="note"][data-idx="${t}"][data-cidx="${e}"]`);if(n){const a="—"!==d.letter?getCourseAction(d.letter):null,r=(s.attempts||[]).length>=2;n.innerHTML=a&&!r?`\n          <button class="link-btn ${"retake"===a.kind?"danger":""}"\n            data-act="addAttempt"\n            data-kind="${a.kind}"\n            data-idx="${t}"\n            data-cidx="${e}">\n            ${a.label}\n          </button>\n        `:'<span class="muted">—</span>'}}}function updateOverviewAndNeed(){const t=calcTotals(state.terms),e=calcRetakeCredits(state.terms),n=calcUnlearnedCredits(state.terms);$("creditsAll").textContent=String(t.C_all),$("creditsPass").textContent=String(t.C_pass),$("gpaAll").textContent=t.gpaAll.toFixed(2),$("gpaPass").textContent=t.gpaPass.toFixed(2),$("creditsRetake").textContent=String(e),$("degree").textContent=degreeFromCgpa(t.gpaPass),$("unlearnedCredits").textContent=String(n);const a=t.S_pass,s=t.C_pass,r=Number($("target").value),d=r-.005,o=r>=3.6?"Xuất sắc":r>=3.2?"Giỏi":r>=2.5?"Khá":"—",i=$("needBox"),c=$("needNote");if(n<=0)$("need").textContent="—",c.textContent="Hãy tạo các kỳ chưa học (Nhập tổng kết kỳ), nhập tín chỉ và để trống GPA.",i.classList.remove("danger");else{const t=(d*(s+n)-a)/n;if(t>4)$("need").textContent="> 4.00",c.innerHTML=`<span class="need-note-strong">Bạn <span class="need-num">không thể</span> đạt được bằng ${escapeHtml(o)} nữa (vì cần trung bình > 4.00 cho phần còn lại).</span>`,i.classList.add("danger");else{const e=clamp(t,0,4).toFixed(2);$("need").textContent=e,c.innerHTML=`<span class="need-note-strong">Để lấy được bằng ${escapeHtml(o)}, các kỳ học còn lại trung bình bạn phải đạt <span class="need-num">${escapeHtml(e)}</span> (hệ 4).</span>`,i.classList.remove("danger")}}state.terms.forEach((t,e)=>{if("courses"!==t.mode)return;if(!document.getElementById(`termSum-${e}`))return;const n=calcTermTotals(t),a=document.getElementById(`tCAll-${e}`),s=document.getElementById(`tCPass-${e}`),r=document.getElementById(`tGAll-${e}`),d=document.getElementById(`tGPass-${e}`);a&&(a.textContent=String(n.C_all)),s&&(s.textContent=String(n.C_pass)),r&&(r.textContent=n.gpaAll.toFixed(2)),d&&(d.textContent=n.gpaPass.toFixed(2))})}document.addEventListener("click",t=>{const e=t.target.closest("button");if(!e)return;const n=e.dataset.act;if("addTerm"===e.id)return state.terms.length>=10?void alert("Tối đa 10 kỳ."):(state.terms.push({name:"",mode:"courses",collapsed:!1,summary:{gpa4:"",credits:""},courses:[]}),ensureMinCourses(state.terms[state.terms.length-1],5),void render());if("reset"!==e.id){if("toggleTerm"===n){const t=+e.dataset.idx,n=state.terms[t];return void(n&&"courses"===n.mode&&(n.collapsed=!n.collapsed,render()))}if("del"===n){const t=+e.dataset.idx;return state.terms.splice(t,1),void render()}if("addCourse"===n){const t=+e.dataset.idx;return state.terms[t].courses.push({name:"",credits:"",attempts:[{type:"main",grade10:""}]}),void render()}if("delCourse"===n){const t=+e.dataset.idx,n=+e.dataset.cidx;return state.terms[t].courses.splice(n,1),void render()}if("addAttempt"===n){const t=+e.dataset.idx,n=+e.dataset.cidx,a=e.dataset.kind,s=state.terms[t].courses[n];if(ensureCourseShape(s),s.attempts.length>=2)return;return s.attempts.push({type:a,grade10:""}),void render()}if("removeAttempt"===n){const t=+e.dataset.idx,n=+e.dataset.cidx,a=+e.dataset.aidx,s=state.terms[t].courses[n];ensureCourseShape(s);const r=Number(a);r>0&&s.attempts.length>r&&(s.attempts.splice(r,1),render())}}else confirm("Xóa toàn bộ dữ liệu đã lưu?")&&(localStorage.removeItem(LS_KEY),state=loadState(),render())}),document.addEventListener("input",t=>{const e=t.target,n=e.dataset.act;if(!n)return;const a=+e.dataset.idx;if("mode"===n)return state.terms[a].mode=e.value,"courses"===state.terms[a].mode&&ensureMinCourses(state.terms[a],5),void render();if("sumGpa4"===n){let t=normalizeTwoDecimals(e.value);const n=t.endsWith("."),s=parseDecimal2(t);if(null!=s&&!n){const e=clamp(s,0,4);t=normalizeTwoDecimals(String(e))}return state.terms[a].summary.gpa4=t,e.value=t,updateOverviewAndNeed(),void saveState()}if("sumCredits"===n)return state.terms[a].summary.credits=String(e.value??"").replace(/[^\d]/g,""),e.value=state.terms[a].summary.credits,updateOverviewAndNeed(),void saveState();if("cName"===n){const t=+e.dataset.cidx;return state.terms[a].courses[t].name=e.value,void saveState()}if("cCredits"===n){const t=+e.dataset.cidx;return state.terms[a].courses[t].credits=String(e.value??"").replace(/[^\d]/g,""),e.value=state.terms[a].courses[t].credits,updateOverviewAndNeed(),void saveState()}if("cGrade10"===n){const t=+e.dataset.cidx,n=+e.dataset.aidx,s=normalizeOneDecimal(e.value),r=state.terms[a].courses[t];return ensureCourseShape(r),r.attempts[n].grade10=s,e.value=s,updateAttemptOutputs(a,t,n),updateOverviewAndNeed(),void saveState()}}),$("target").addEventListener("change",()=>{updateOverviewAndNeed(),saveState()});const GUIDE_KEY="study_tracker_guide_collapsed";function setGuideCollapsed(t){const e=document.getElementById("guideBody"),n=document.getElementById("toggleGuide");e&&n&&(e.style.display=t?"none":"block",n.textContent=t?"Hiện":"Ẩn",localStorage.setItem(GUIDE_KEY,t?"1":"0"))}document.getElementById("toggleGuide")?.addEventListener("click",()=>{setGuideCollapsed(!("1"===localStorage.getItem(GUIDE_KEY)))}),setGuideCollapsed("1"===localStorage.getItem(GUIDE_KEY)),render()</script></body></html>